<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE section
[
  <!ENTITY % entities SYSTEM "generic-entities.ent">
    %entities;
]>

<section xml:id="mirror-repositories-with-rmt" xml:lang="en"
 xmlns="http://docbook.org/ns/docbook" version="5.1"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink">
 <title>Mirroring &reponame; repositories with &rmt;</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker></dm:bugtracker>
   <dm:translation>no</dm:translation>
  </dm:docmanager>
 </info>

 <para>
  Use this procedure to mirror the &reponame; repositories for
  <phrase audience="sll">&rhel; &productnumber; and </phrase>CentOS Linux &productnumber;.
 </para>
 <itemizedlist>
  <title>Requirements</title>
  <listitem>
   <para>
    The &rmt; server is installed and up to date.
   </para>
  </listitem>
  <listitem>
   <para>
    The &rmt; server has enough storage available for repository mirroring. The amount of storage
    required depends on the number of repositories you mirror. We recommend at least 1.5 times
    the total size of all enabled repositories. Be aware that the &reponame; repositories will
    grow over time.
   </para>
  </listitem>
  <listitem>
   <para>
    Your organization credentials appear correctly in <filename>/etc/rmt.conf</filename>.
   </para>
  </listitem>
  <listitem>
   <para>
    You have a &productname; subscription activated in the <link xlink:href="&sccurl;">&scc;</link>.
   </para>
  </listitem>
 </itemizedlist>

 <important audience="sll">
   <title>New repository structure for &reponame; &productnumber;</title>
   <para>
     The repository structure has changed in &reponame; &productnumber;. Previously, there was
     one default repository and one optional <literal>Source</literal> repository. Now there are
     two default repositories, <literal>BASE</literal> and <literal>LTSS</literal>, along with
     optional <literal>Source</literal> and <literal>Debug</literal> repositories for both.
   </para>
   <para>
     The <literal>BASE</literal> repositories are frozen and contain the existing packages from
     the original &productname; repositories. The <literal>LTSS</literal> repositories contain
     new packages for &reponame; &productnumber;.
   </para>
   <para>
    If you previously mirrored the &productname; repositories with the general subscription,
    clean up these repositories first before you start mirroring the new LTSS repositories:
   </para>
   <orderedlist>
     <listitem>
       <para>
         Disable the original product. This also disables any repositories associated with the product:
       </para>
<screen>&prompt.root;<command>rmt-cli product disable 1251</command></screen>
     </listitem>
     <listitem>
       <para>
         Free up space on the server by cleaning up the files associated with the disabled repositories:
       </para>
<screen>&prompt.root;<command>rmt-cli repos clean</command></screen>
     </listitem>
   </orderedlist>
 </important>

 <procedure xml:id="pro-mirror-repositories-with-rmt">
  <title>Mirroring the &reponame; repositories with &rmt;</title>
  <step>
   <para>
    On the &rmt; server, update the available product and repository metadata:
   </para>
<screen>&prompt.root;<command>rmt-cli sync</command></screen>
   <para>
    Synchronization is also performed automatically by
    <systemitem>rmt-server-sync.timer</systemitem>. You can check the status and
    the next scheduled synchronization time with the following command:
   </para>
<screen>&prompt.root;<command>systemctl status rmt-server-sync.timer</command></screen>
  </step>
  <step>
   <para>
    Enable &reponame; &productnumber; using the product ID <literal>2702</literal>:
   </para>
<screen>&prompt.root;<command>rmt-cli product enable 2702</command></screen>
   <para>
    This enables all the default repositories associated with the product.
   </para>
  </step>
  <step>
   <para>
    If you also need the <literal>Source</literal> or <literal>Debug </literal>repositories,
    find and enable them with the following commands:
   </para>
<screen>&prompt.root;<command>rmt-cli repo list --all | grep RES-7-BASE</command>
&prompt.root;<command>rmt-cli repo list --all | grep RES-7-LTSS</command>
&prompt.root;<command>rmt-cli repo enable <replaceable>REPO_ID</replaceable></command></screen>
  </step>
  <step>
   <para>
    Start package mirroring for the enabled repositories:
   </para>
<screen>&prompt.root;<command>rmt-cli mirror</command></screen>
   <para>
    Packages are downloaded to the &rmt; server once per day by
    <systemitem>rmt-server-mirror.timer</systemitem>. You can check the status
    and the next scheduled download time with the following command:
   </para>
<screen>&prompt.root;<command>systemctl status rmt-server-mirror.timer</command></screen>
  </step>
 </procedure>
 <itemizedlist>
  <title>More information</title>
  <listitem>
   <para>
    <link xlink:href="https://documentation.suse.com/sles-15/html/SLES-all/cha-rmt-mirroring.html">
    Mirroring repositories on the &rmt; server</link>
   </para>
  </listitem>
 </itemizedlist>
</section>
