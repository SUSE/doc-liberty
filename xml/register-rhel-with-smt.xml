<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE section
[
  <!ENTITY % entities SYSTEM "generic-entities.ent">
    %entities;
]>

<section xml:id="register-7-with-smt" xml:lang="en"
 xmlns="http://docbook.org/ns/docbook" version="5.1"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink">
 <title>Registering &rhla; or CentOS Linux with &smt;</title>

 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker></dm:bugtracker>
   <dm:translation>no</dm:translation>
  </dm:docmanager>
 </info>

 <para>
  Use this procedure to register &rhel; 7 or CentOS Linux 7 with the &smt; server.
 </para>
 <important role="compact">
  <para>
   CentOS Stream is not supported.
  </para>
 </important>
 <itemizedlist>
  <title>Prerequisites</title>
  <listitem>
   <para>
    <xref linkend="configure-smt-server"/>
   </para>
  </listitem>
  <listitem>
   <para>
    <xref linkend="mirror-repositories-with-smt"/>
   </para>
  </listitem>
  <listitem>
   <para>
    The system you want to register can access the &smt; server.
   </para>
  </listitem>
  <listitem>
   <para>
    The system you want to register is running the latest version of &rhla; 7
    or CentOS Linux 7.
   </para>
  </listitem>
  <listitem>
   <para>
    You have a &productname; subscription activated in the &scc;.
   </para>
  </listitem>
  <listitem>
   <para>
    The &rhla; or CentOS repositories are still enabled. These might be
    required for package dependencies during the registration procedure.
   </para>
  </listitem>
 </itemizedlist>
 <procedure xml:id="pro-register-7-with-smt">
  <title>Registering &rhla; or CentOS Linux with &smt;</title>
  <step>
   <para>
    Import the repository signing key from the &smt; server:
   </para>
<screen>&prompt.root;<command>rpm --import -vv http://<replaceable>SMT_SERVER_URL</replaceable>/repo/keys/res-signingkeys.key</command></screen>
   <para>
    Use <option>-vv</option> to verify the import. Look for <literal>D: added key
    gpg-pubkey-<replaceable>ID-STRING</replaceable> to keyring</literal>.
   </para>
  </step>
  <step>
   <para>
    Create a file called <filename>/etc/yum.repos.d/liberty7.repo</filename> and
    add the following content:
   </para>
<screen>[liberty7]
name=SUSE Liberty Linux 7
baseurl=http://<replaceable>SMT_SERVER_URL</replaceable>/repo/$RCE/RES7/x86_64/
enabled=1
gpgcheck=1</screen>
  </step>
  <step>
   <para>
    Install the <package>suseRegisterRES</package> package:
   </para>
<screen>&prompt.root;<command>yum install suseRegisterRES</command></screen>
  </step>
  <step>
   <para>
    Copy the &smt; certificate to the system:
   </para>
<screen>&prompt.root;<command>wget http://<replaceable>SMT_SERVER_URL</replaceable>/smt.crt</command>
&prompt.root;<command>cat smt.crt >> /etc/pki/tls/cert.pem</command></screen>
  </step>
  <step>
   <para>
    Disable the &rhla; or CentOS repositories in <filename>/etc/yum.repos.d</filename>
    by setting <literal>enabled=0</literal> in each <filename>.repo</filename> file.
   </para>
  </step>
  <step>
   <para>
    Edit <filename>/etc/suseRegister.conf</filename> to point to &smt; by
    changing the <literal>url</literal> value:
   </para>
<screen>url = https://<replaceable>SMT_SERVER_URL</replaceable>/center/regsvc/</screen>
  </step>
  <step>
   <para>
    Register the system:
   </para>
<screen>&prompt.root;<command>suse_register</command></screen>
  </step>
  <step>
   <para>
    Run the update command to make sure there are no errors:
   </para>
<screen>&prompt.root;<command>yum update</command></screen>
  </step>
 </procedure>
 <para>
  You can now remove the system from any &rh; subscription services it was
  registered to, and receive updates from repositories provided by &productname;.
 </para>
</section>
