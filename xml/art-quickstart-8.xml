<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:docbook51-profile.xsl"
 type="text/xml"
 title="Profiling step"?>
<!DOCTYPE article
[
  <!ENTITY % entities SYSTEM "generic-entities.ent">
    %entities;
]>

<article xml:id="art-quickstart-8" xml:lang="en"
 xmlns="http://docbook.org/ns/docbook" version="5.1"
 xmlns:its="http://www.w3.org/2005/11/its"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink">

 <info>
  <title>Registering &rhla; 8 or CentOS Linux 8</title>
  <productname>&productname;</productname>
  <date><?dbtimestamp format="B d, Y"?></date>
  <xi:include href="common_copyright_gfdl.xml"/>
  <abstract>
   <para>
    This guide describes how to attach a &productname; subscription to
    &rhel;&nbsp;8 or CentOS&nbsp;Linux&nbsp;8 using &suse;'s &rmtool;.
   </para>
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker>
    <dm:url>https://github.com/SUSE/doc-liberty/issues/new</dm:url>
    <dm:labels>documentation,issue</dm:labels>
    <dm:version>8</dm:version>
    <dm:assignee>tahliar</dm:assignee>
   </dm:bugtracker>
   <dm:editurl>https://github.com/SUSE/doc-liberty/edit/main/xml/</dm:editurl>
   <dm:translation>no</dm:translation>
  </dm:docmanager>
 </info>

 <section xml:id="introduction-quickstart-8">
  <title>Introduction</title>
   <para>
    &productname; is a technology and support solution for mixed Linux environments.
    With a &productname; subscription, you can register and receive updates for
    &rhel;, CentOS Linux, and &sles;. An optional &ha; extension is also available.
   </para>
   <important role="compact">
    <para>
     CentOS&nbsp;Stream is not supported.
    </para>
   </important>
   <para>
    To register &rhel; 8 or CentOS Linux 8, use &suse;'s &rmtool; (&rmt;).
    &rmt; is a proxy system for the &scc;. The &rmt; server is registered with
    the &scc;, and other systems in the network are registered with the &rmt;
    server and receive packages from it directly. For more information, see the
    <link xlink:href="&dsc-sles;/&slesnumber;/html/SLES-all/book-rmt.html">&rmtguide;</link>.
   </para>
   <para>
    Registering &rhla; or CentOS Linux with &rmt; involves the following steps:
   </para>
   <orderedlist>
    <listitem>
     <para>
      <xref linkend="requirements-quickstart-8"/>. Make sure you have everything
      required for the following procedures.
     </para>
    </listitem>
    <listitem>
     <para>
      <xref linkend="configure-rmt-server"/>. This server must be installed on
      &sles; 15. You can skip this step if you already have an &rmt; server in
      your network.
     </para>
    </listitem>
    <listitem>
     <para>
      <xref linkend="mirror-repositories-with-rmt"/>. You can skip this step if
      &productname; is already enabled and mirrored on your &rmt; server.
     </para>
    </listitem>
    <listitem>
     <para>
      <xref linkend="register-rhel-with-rmt"/>. &rmt; includes a setup script to
      automate the registration process.
     </para>
    </listitem>
   </orderedlist>
   <note><!-- Can delete this if/when all names have been changed -->
    <title><emphasis>&productname;</emphasis> and <emphasis>&sles; with Expanded Support</emphasis></title>
    <para>
     <emphasis>&productname;</emphasis> now provides what used to be covered by
     the <emphasis>&sles; with Expanded Support</emphasis> subscription. Some
     components might still use the <emphasis>Expanded Support</emphasis> name
     during the transition period.
    </para>
   </note>
 </section>

 <section xml:id="requirements-quickstart-8">
  <title>Requirements</title>
  <itemizedlist>
   <listitem>
    <para>
     You have a &productname; subscription.
    </para>
   </listitem>
   <listitem>
    <para>
     You have a <link xlink:href="https://scc.suse.com">&scc;</link> account.
    </para>
   </listitem>
   <listitem>
    <para>
     The systems you want to register have been updated to the latest version of
     &rhla; 8 or CentOS Linux 8.
    </para>
   </listitem>
   <listitem>
    <para>
     &sles; (&slsa;) 15 is installed and running in the same network as the
     systems you want to register. You can use the &productname; subscription to
     register the &slsa; server. To install the latest version of &slsa; 15, see the
     <link xlink:href="&dsc-sles;/&slesnumber;/html/SLES-all/article-installation.html">
     &instquick;</link>.
    </para>
   </listitem>
   <listitem>
    <para>
     The &slsa; server has enough storage available for repository mirroring.
    </para>
    <para>
     Downloaded packages are stored in <filename>/usr/share/rmt/public/repo</filename>,
     which is a symbolic link to <filename>/var/lib/rmt/public/repo/</filename>.
     The amount of storage required depends on the number of repositories that you
     mirror, and the number of products that you enable. We recommend 1.5 times
     the total size of all enabled repositories, or approximately 200 GB per release.
    </para>
   </listitem>
  </itemizedlist>
 </section>

<xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="configure-rmt-server.xml"/>

<xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="mirror-repositories-with-rmt.xml"/>

<xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="register-rhel-with-rmt.xml"/>

 <section xml:id="troubleshoot-quickstart-8">
  <title>Troubleshooting</title>
  <variablelist>
   <varlistentry>
    <term><systemitem>nginx.service</systemitem> is inactive after installing the
    <package>rmt-server</package> package</term>
    <listitem>
     <para>
      Continue the procedure to configure &rmt; in &yast;. This often resolves
      the issue. If that fails, Apache might be installed on your server, and
      must be disabled. Apache conflicts with NGINX because both web servers
      listen on port 80.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>&productname; doesn't appear in <command>rmt-cli products list</command>
     after <command>rmt-cli sync</command></term>
    <listitem>
     <para>
      Check your network. If the network is down, the sync command fails without
      showing an error.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Mirroring completes with errors</term>
    <listitem>
     <para>
      If some packages could not be downloaded due to timeouts, rerun the
      <command>rmt-cli mirror</command> command until all packages are downloaded.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Setup script cannot access the &productname; repository</term>
    <listitem>
     <para>
      The <filename>repodata</filename> directory on the RMT server will not
      be available until all of the packages for that repository are downloaded.
      If some packages could not be downloaded to the RMT server due to timeouts
      during the first mirroring, rerun the <command>rmt-cli mirror</command>
      command until all packages are downloaded.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Setup script cannot remove the protected package
    <package>redhat-release</package></term>
    <listitem>
     <para>
      On &rhla;, the <package>redhat-release</package> package is protected as a
      dependency of the <package>setup</package> package. If necessary, you can
      use the following command to remove <package>redhat-release</package>
      without checking for dependencies:
     </para>
<screen>&prompt.root;<command>rpm -e redhat-release --nodeps</command></screen>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Setup script cannot install <package>sles_es-release</package> because
    of package conflicts</term>
    <listitem>
     <para>
      If <package>sles_es-release</package> conflicts with existing packages,
      try the following workaround:
     </para>
     <orderedlist>
      <listitem>
       <para>
       Remove the <filename>redhat-release</filename> directory:
       </para>
<screen>&prompt.root;<command>rm -r /usr/share/redhat-release</command></screen>
       <para>
        On CentOS, this removes the symbolic link between
        <filename>redhat-release</filename> and <filename>centos-release</filename>.
       </para>
      </listitem>
      <listitem>
       <para>
        Edit the <filename>rmt-client-setup-res</filename> script to add
        <literal>--allowerasing</literal> to the following line:
       </para>
<screen>$DNF install ${AUTOACCEPT} SUSEConnect sles_es-release librepo-1.9.2 <emphasis role="bold">--allowerasing</emphasis></screen>
      </listitem>
     </orderedlist>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Setup script cannot install <package>SUSEConnect</package> because of
    package dependencies</term>
    <listitem>
     <para>
      &productname; only supports the latest version of &rhla; or CentOS Linux.
      If your system is running the latest version and <package>SUSEConnect</package>
      still has package dependency issues, try the following workaround:
     </para>
     <orderedlist>
      <listitem>
       <para>
        Edit the <filename>rmt-client-setup-res</filename> script to add
        <literal>--skip-broken</literal> to the following line:
       </para>
<screen>$DNF install ${AUTOACCEPT} SUSEConnect sles_es-release librepo-1.9.2 <emphasis role="bold">--skip-broken</emphasis></screen>
      </listitem>
      <listitem>
       <para>
        Run the script and accept any proposed package changes.
        <package>SUSEConnect</package> will be skipped.
       </para>
      </listitem>
      <listitem>
       <para>
        Run the script a second time. The package changes from the first attempt
        can sometimes resolve the package dependency issues, allowing the second
        attempt to successfully install <package>SUSEConnect</package>.
       </para>
      </listitem>
     </orderedlist>
    </listitem>
   </varlistentry>
  </variablelist>
 </section>
 <xi:include href="common_legal.xml"/>
</article>
