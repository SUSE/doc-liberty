<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE section
[
  <!ENTITY % entities SYSTEM "generic-entities.ent">
    %entities;
]>

<section xml:id="mirror-repositories-with-smt" xml:lang="en"
 xmlns="http://docbook.org/ns/docbook" version="5.1"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink">
 <title>Mirroring &productname; repositories with &smt;</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker></dm:bugtracker>
   <dm:translation>no</dm:translation>
  </dm:docmanager>
 </info>

 <para>
  Use this procedure to mirror the &productname; repositories for &rhel; &productnumber;
  and CentOS Linux &productnumber;.
 </para>
 <itemizedlist>
  <title>Requirements</title>
  <listitem>
   <para>
    <xref linkend="configure-smt-server"/>
   </para>
  </listitem>
  <listitem>
   <para>
    The &smt; server has enough storage available for repository mirroring.
   </para>
  </listitem>
  <listitem>
   <para>
    Your organization credentials appear correctly in <filename>/etc/smt.conf</filename>.
   </para>
  </listitem>
  <listitem>
   <para>
    You have a &productname; subscription activated in the &scc;.
   </para>
  </listitem>
 </itemizedlist>

 <procedure xml:id="pro-mirror-repositories-with-smt">
  <title>Mirroring &productname; repositories with &smt;</title>
  <step>
   <para>
    On the &smt; server, update the available product and repository metadata:
   </para>
<screen>&prompt.root;<command>smt-sync</command></screen>
  </step>
  <step>
   <para>
    Enable &productname; with the following command:
   </para>
<screen>&prompt.root;<command>smt-repos --enable-mirror RES-&productnumber;-Updates</command>
1 repository enabled.</screen>
  </step>
  <step>
   <para>
    If your subscription includes the &ha; extension, enable the extension with
    the following command:
   </para>
<screen>&prompt.root;<command>smt-repos --enable-mirror RES-&productnumber;-HA-Updates</command>
1 repository enabled.</screen>
   <tip role="compact">
    <para>
     To check whether the extension is available, run the following command:
     <command>smt-repos RES-&productnumber;-HA-Updates</command>
    </para>
   </tip>
  </step>
  <step>
   <para>
    Start package mirroring for the enabled repositories, and log the output
    in case you need to troubleshoot errors:
   </para>
<screen>&prompt.root;<command>smt-mirror --debug --logfile /var/log/smt/smt-mirror.log</command></screen>
   <para>
    Packages will now be mirrored to the &smt; server once per day.
   </para>
  </step>
  <step>
   <para>
    To enable GPG checking, install the <package>res-signingkeys</package>
    package on the &smt; server:
   </para>
<screen>&prompt.root;<command>zypper in res-signingkeys</command></screen>
   <para>
    The key is now available on the &smt; server and can be imported to clients.
    You can check for the key in <filename>/srv/www/htdocs/repo/keys/</filename>
    on the server, or at <literal>http://<replaceable>SMT_SERVER_URL</replaceable>/repo/keys/</literal>
    in a browser.
   </para>
  </step>
 </procedure>
 <itemizedlist>
  <title>More information</title>
  <listitem>
   <para>
    <link xlink:href="https://documentation.suse.com/sles-12/html/SLES-all/smt-mirroring.html">
    Mirroring Repositories on the &smt; Server</link>
   </para>
  </listitem>
 </itemizedlist>
</section>
